$def with(work)

$if work and not is_bot():
    $ work_subjects_authors = cached_work_authors_and_subjects(work.key)
    $ authors = ', '.join([author if isinstance(author, basestring) else author.name for author in work_subjects_authors.get('authors', [])])
    <div class="related-books">
      $:macros.IABookCarousel(key="related-subjects-carousel", title="You might also like", work_id=work.key, _type="subjects", limit=18, min_books=1)
      $:macros.IABookCarousel(key="related-authors-carousel", title="More by %s" % (authors or "this author"), work_id=work.key, _type="authors", limit=18, min_books=1)
    </div>
